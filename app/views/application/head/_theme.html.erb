<% if defined?(Current.user.preferences[:color_theme]) && Current.user.preferences[:color_theme].present? %> 
    <script>
        document.documentElement.setAttribute('data-theme', '<%= Current.user.preferences[:color_theme] %>');
    </script>
<% else %>
    <script>
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        if (prefersDarkScheme.matches) {
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.setAttribute('data-theme', 'light');
        }
    </script>
<% end %>